type: YUGABYTE
driver: com.yugabyte.Driver
url: jdbc:yugabytedb://{{endpoint}}:5433/yugabyte?sslmode=require&ApplicationName=featurebench&reWriteBatchedInserts=true&load-balance=false
username: {{username}}
password: {{password}}
batchsize: 128
isolation: TRANSACTION_REPEATABLE_READ
loaderthreads: 1
terminals: 1
collect_pg_stat_statements: true
use_dist_in_explain : true
yaml_version: v1.0
works:
    work:
        time_secs: 180
        active_terminals: 1
        rate: unlimited
        warmup: 60
microbenchmark:
    class: com.oltpbenchmark.benchmarks.featurebench.customworkload.YBDefaultMicroBenchmark
    properties:
        setAutoCommit: true
        create:
            - DROP TABLE IF EXISTS THRPT_G1_range_table_1;
            - CREATE TABLE THRPT_G1_range_table_1(id INT, region_id INT, category_id INT, subcategory_id INT, date_created DATE, status_code INT, priority_level INT, amount INT, quantity INT, PRIMARY KEY(id ASC)) SPLIT AT VALUES ((333333), (666666));
            - CREATE INDEX idx_partial_status ON THRPT_G1_range_table_1 (region_id ASC, category_id ASC, date_created ASC, id ASC)   SPLIT AT VALUES ((33), (66)) WHERE status_code IN (1, 2, 3) and priority_level IN (1, 2, 3);
            - CREATE index idx_covering_region_cat_amount_asc on thrpt_g1_range_table_1 (region_id ASC, category_id ASC, id ASC) INCLUDE (amount, quantity, status_code)  SPLIT AT VALUES ((33), (66));

        cleanup:
            - DROP TABLE IF EXISTS THRPT_G1_range_table_1;

        loadRules:
              - table: THRPT_G1_range_table_
                count: 1
                rows: 1000000
                columns:
                    - name: id
                      util: RandomUniqueIntGen
                      params: [ 1, 1000000 ]
                    - name: region_id
                      util: RandomNumber
                      params: [ 1, 100 ]
                    - name: category_id
                      util: RandomNumber
                      params: [ 1, 50 ]
                    - name: subcategory_id
                      util: RandomNumber
                      params: [ 1, 500 ]
                    - name: date_created
                      util: RandomDateBtwYears
                      params: [2000, 2025]
                    - name: status_code
                      util: RandomNumber
                      params: [ 1, 5 ]
                    - name: priority_level
                      util: RandomNumber
                      params: [ 1, 10 ]
                    - name: amount
                      util: RandomNumber
                      params: [ 1, 100000 ]
                    - name: quantity
                      util: RandomNumber
                      params: [ 1, 100000 ]

        executeRules:

            -   workload: THRPT_G8_DISTINCT_Index_Sq
                run:
                    -   name: thrpt_wrkld_8
                        weight: 100
                        queries:
                            -   query: SELECT region_id, category_id, subcategory_id, COUNT(*) FROM THRPT_G1_range_table_1 WHERE region_id = 1 and category_id < 25 GROUP BY region_id, category_id, subcategory_id;
